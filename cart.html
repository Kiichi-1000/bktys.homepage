<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cart - BKTYSSHOP</title>
  <link rel="stylesheet" href="css/sanitize.css">
  <link rel="stylesheet" href="css/base.css">
  <link rel="stylesheet" href="css/components.css">
  <link rel="stylesheet" href="css/animations.css">
  <style>
    :root{ --gap: clamp(16px, 2vw, 24px) }
    .page{ padding-top:64px; background: #000; color: #fff; }
    .container{ padding:20px 16px; max-width:1000px; margin:0 auto }
    .head{ display:flex; align-items:center; justify-content:space-between; margin-bottom:16px }
    .head h1{ color: #fff; animation: neonGlow 3s ease-in-out infinite; }
    .items{ display:grid; gap:16px }
    .row{ display:grid; grid-template-columns: 80px 1fr auto; gap:12px; align-items:center; padding:12px; border:1px solid rgba(0,200,83,0.3); border-radius:16px; background: rgba(0,0,0,0.8); backdrop-filter: blur(10px); transition: all 0.3s ease; }
    .row:hover{ border-color: rgba(0,200,83,0.6); box-shadow: 0 4px 15px rgba(0,200,83,0.2); }
    .row img{ width:80px; height:80px; object-fit:cover; border-radius:8px }
    .row div{ color: #fff; }
    .qty{ display:flex; gap:6px; align-items:center }
    .qty button{ width:28px; height:28px; border:1px solid rgba(0,200,83,0.3); background: rgba(0,0,0,0.6); color: #00C853; border-radius:6px; cursor: pointer; transition: all 0.3s ease; backdrop-filter: blur(10px); }
    .qty button:hover{ background: rgba(0,200,83,0.1); border-color: rgba(0,200,83,0.6); }
    .progress{ margin:16px 0; background: rgba(255,255,255,0.1); border-radius:999px; overflow:hidden; height:10px; border: 1px solid rgba(0,200,83,0.3); }
    .progress .bar{ height:100%; width:0; background: linear-gradient(90deg, #00C853, #4CAF50); transition: width 0.5s ease; animation: anticipationShimmer 2s infinite; box-shadow: 0 0 10px rgba(0,200,83,0.5); }
    .totals{ margin-top:16px; border-top:1px solid rgba(0,200,83,0.3); padding-top:12px; display:grid; gap:6px; text-align:right; color: #fff; }
    .cta{ margin-top:12px; text-align:right }
    .cta a{ display:inline-block; background: linear-gradient(45deg, #00C853, #4CAF50); color:#fff; padding:12px 16px; border-radius:12px; text-decoration:none; font-weight:700; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(0,200,83,0.3); position: relative; overflow: hidden; }
    .cta a::before{ content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent); transition: left 0.5s ease; }
    .cta a:hover::before{ left: 100%; }
    .cta a:hover{ transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,200,83,0.4); }
    .empty{ text-align:center; padding:40px 0; color:#ccc; }
    .empty h3{ color: #fff; }
  </style>
</head>
<body>
  <header class="site-header future-header">
    <div class="header-inner">
      <label for="nav-toggle" class="hamburger" aria-label="メニューを開閉"><span></span><span></span><span></span></label>
      <a class="brand" href="brand.html" aria-label="BKTYSSHOP Home">BKTYSSHOP</a>
      <input id="nav-toggle" class="nav-toggle" type="checkbox" aria-hidden="true">
      <nav class="nav" aria-label="ナビゲーション">
        <ul>
          <li><a href="brand.html">Home</a></li>
          <li><a href="https://velara.official.ec/" target="_blank">Official</a></li>
          <li><a href="members.html">Members</a></li>
          <li><a href="cart.html" class="shop-cart future-cart-icon" aria-label="Cart"><span class="cart-emoji">🛒</span><span id="cart-badge" class="badge" aria-live="polite">0</span></a></li>
        </ul>
      </nav>
      <label class="menu-overlay" for="nav-toggle" aria-hidden="true"></label>
      <aside class="menu-drawer" aria-label="メニュー">
        <header class="drawer-head"><span class="drawer-title">BKTYSSHOP</span><label for="nav-toggle" class="drawer-close" aria-label="閉じる">×</label></header>
        <ul class="drawer-nav">
          <li><a href="brand.html">Home</a></li>
          <li><a href="https://velara.official.ec/" target="_blank">Official</a></li>
          <li><a href="members.html">Members</a></li>
          <li><a href="cart.html">Cart</a></li>
        </ul>
      </aside>
    </div>
  </header>
  <main class="page">
    <div class="container">
      <div class="head"><h1>カート</h1></div>
      <div id="free-msg"></div>
      <div class="progress"><div id="bar" class="bar"></div></div>
      <div id="items" class="items"></div>
      <div class="totals">
        <div>小計：<span id="subtotal">¥0</span></div>
        <div>送料：<span id="shipping">¥0</span></div>
        <div><strong>合計：<span id="total">¥0</span></strong></div>
      </div>
      <div class="cta"><a href="checkout.html">購入手続きへ</a></div>
    </div>
  </main>
  <footer class="footer"><div class="container"><p>&copy; 2025 BKTYS. All rights reserved.</p></div></footer>
  <script src="js/analytics.js"></script>
  <script src="js/products-fallback.js"></script>
  <script src="js/cart.js"></script>
  <script>
    function money(n){ return '¥'+(n||0).toLocaleString(); }
    function render(){
      const cart = BKTYSCart.calc(BKTYSCart.load());
      const wrap = document.getElementById('items');
      if(cart.items.length===0){ 
        wrap.innerHTML = '<div class="empty"><h3>カートは空です</h3><p>商品を追加してください</p></div>'; 
      }
      else{
        wrap.innerHTML = cart.items.map((i,idx)=>`<div class="row" data-idx="${idx}">\n          <img src="${i.image}" alt="${i.name}">\n          <div><div>${i.name}</div><div>サイズ：${i.size}</div></div>\n          <div class="qty">\n            <button data-dec>-</button><span>${i.qty}</span><button data-inc>+</button>\n            <span style="margin-left:10px">${money(i.price*i.qty)}</span>\n            <button data-del style="margin-left:10px">削除</button>\n          </div>\n        </div>`).join('');
      }
      document.getElementById('subtotal').textContent = money(cart.subtotal);
      document.getElementById('shipping').textContent = money(cart.shipping);
      document.getElementById('total').textContent = money(cart.total);
      const p = BKTYSCart.progress(cart.subtotal);
      document.getElementById('bar').style.width = p.percent+'%';
      document.getElementById('free-msg').textContent = p.isFree? '🎉 送料無料になりました！' : `あと${money(p.remain)}で送料無料`;
      
      // 送料無料達成時のドーパミン刺激
      if (p.isFree && p.percent === 100) {
        const progressBar = document.getElementById('bar');
        if (progressBar) {
          progressBar.classList.add('success-glow');
          setTimeout(() => progressBar.classList.remove('success-glow'), 1500);
        }
      }
      
      // bind
      wrap.querySelectorAll('.row').forEach(row=>{
        const idx = +row.dataset.idx;
        row.querySelector('[data-inc]')?.addEventListener('click', ()=>{ 
          const c=BKTYSCart.load(); 
          c.items[idx].qty++; 
          BKTYSCart.save(c); 
          render(); 
          // カートバッジ更新
          if (window.BKTYSCart && window.BKTYSCart.updateBadge) {
            window.BKTYSCart.updateBadge();
          }
        });
        row.querySelector('[data-dec]')?.addEventListener('click', ()=>{ 
          const c=BKTYSCart.load(); 
          c.items[idx].qty=Math.max(1,c.items[idx].qty-1); 
          BKTYSCart.save(c); 
          render(); 
          // カートバッジ更新
          if (window.BKTYSCart && window.BKTYSCart.updateBadge) {
            window.BKTYSCart.updateBadge();
          }
        });
        row.querySelector('[data-del]')?.addEventListener('click', ()=>{ 
          const c=BKTYSCart.load(); 
          c.items.splice(idx,1); 
          BKTYSCart.save(c); 
          render(); 
          // カートバッジ更新
          if (window.BKTYSCart && window.BKTYSCart.updateBadge) {
            window.BKTYSCart.updateBadge();
          }
        });
      });
    }
    // 規約同意チェック
    function checkTermsAgreement() {
      const agreed = localStorage.getItem('bktys_terms_agreed');
      if (!agreed) {
        // 規約未同意の場合は規約ページへリダイレクト
        window.location.href = 'terms.html';
        return false;
      }
      
      try {
        const agreementData = JSON.parse(agreed);
        if (!agreementData.agreed) {
          // 規約未同意の場合は規約ページへリダイレクト
          window.location.href = 'terms.html';
          return false;
        }
      } catch (e) {
        // エラーの場合は規約ページへリダイレクト
        window.location.href = 'terms.html';
        return false;
      }
      
      return true;
    }

    document.addEventListener('DOMContentLoaded', function() {
      // 規約同意チェック
      if (!checkTermsAgreement()) {
        return;
      }
      
      // カートバッジの初期化
      if (window.BKTYSCart && window.BKTYSCart.updateBadge) {
        window.BKTYSCart.updateBadge();
      }
      
      render();
    });
  </script>
</body>
</html>


